# 🧠 Intelligent Tagging System

## Overview

The Intelligent Tagging System is a comprehensive solution that automatically generates semantic tags, relationship mappings, and temporal metadata for context fossils. This system enhances LLM interactions by providing rich, structured metadata that enables better understanding, retrieval, and analysis of stored knowledge.

## 🎯 Key Features

### 1. **Semantic Tagging**
- **LLM-Powered Analysis**: Uses OpenAI GPT models to analyze content and generate intelligent tags
- **Fallback System**: Graceful degradation to rule-based tagging when LLM is unavailable
- **Confidence Scoring**: Each semantic tag includes a confidence score (0.0-1.0)
- **Auto-Generation Detection**: Tracks whether tags were manually added or auto-generated

### 2. **Relationship Mapping**
- **Semantic Similarity**: Identifies related fossils based on content similarity
- **Dependency Detection**: Finds fossils that depend on or reference others
- **Supersession Tracking**: Identifies when newer fossils replace older ones
- **Duplicate Grouping**: Groups similar fossils for better organization

### 3. **Temporal Management**
- **Lifecycle Tracking**: Active, archived, or deprecated status
- **Access Patterns**: Tracks when fossils are accessed and how frequently
- **Expiration Management**: Automatic expiration for time-sensitive content
- **Version History**: Complete audit trail of changes

## 🏗️ Architecture

### Core Components

```typescript
interface ContextEntry {
  // ... existing fields ...
  
  semanticTags?: {
    contentHash: string;
    duplicateGroup?: string;
    semanticCategory?: string;
    confidence?: number;
    autoGenerated?: boolean;
    concepts?: string[];
    sentiment?: 'positive' | 'negative' | 'neutral';
    priority?: 'low' | 'medium' | 'high' | 'critical';
    impact?: 'low' | 'medium' | 'high' | 'critical';
    stakeholders?: string[];
    similarityScore?: number;
  };
  
  relationships?: {
    relatedTo?: string[];
    dependsOn?: string[];
    supersedes?: string[];
    partOf?: string[];
    duplicateGroup?: string[];
  };
  
  temporal?: {
    expiresAt?: string;
    lifecycle?: 'active' | 'archived' | 'deprecated';
    lastAccessed?: string;
    accessCount?: number;
  };
}
```

### Service Architecture

```
SemanticTaggerService
├── generateSemanticTags()     # LLM-powered semantic analysis
├── generateRelationshipTags() # Relationship mapping
├── generateTemporalTags()     # Temporal metadata
└── calculateSemanticSimilarity() # Similarity scoring
```

## 🚀 Usage

### Automatic Tagging

New fossils are automatically enhanced with intelligent tags:

```bash
# Create a new fossil with automatic intelligent tagging
bun run src/cli/context-fossil.ts add \
  --type observation \
  --title "Repository Health Analysis" \
  --content "Health score: 85/100. Issues: 2. Recommendations: Add tests." \
  --tags "health,analysis" \
  --source automated
```

### Manual Enhancement

Enhance existing fossils with intelligent tags:

```bash
# Enhance a specific fossil
bun run src/cli/context-fossil.ts enhance --entry-id fossil_123

# Enhance all fossils
bun run src/cli/context-fossil.ts enhance --all

# Dry run to see what would be enhanced
bun run src/cli/context-fossil.ts enhance --all --dry-run
```

### Querying Enhanced Fossils

```bash
# Query by semantic category
bun run src/cli/context-fossil.ts query --tags "automation"

# Query by priority
bun run src/cli/context-fossil.ts query --tags "high-priority"

# Query by lifecycle status
bun run src/cli/context-fossil.ts query --tags "active"
```

## 🧠 Semantic Analysis

### LLM Prompt Structure

The system uses structured prompts to generate consistent semantic tags:

```
Analyze this fossil entry and provide semantic tags in JSON format:

Entry Type: {type}
Title: {title}
Content: {content}
Tags: {tags}

Please provide a JSON response with the following structure:
{
  "semanticCategory": "category-name",
  "confidence": 0.95,
  "concepts": ["concept1", "concept2"],
  "sentiment": "positive|negative|neutral",
  "priority": "low|medium|high|critical",
  "impact": "low|medium|high|critical",
  "stakeholders": ["stakeholder1", "stakeholder2"]
}
```

### Semantic Categories

Common semantic categories include:
- `repository-health`: Repository analysis and health scores
- `automation`: Workflow automation and scripts
- `documentation`: README, guides, and documentation
- `testing`: Test coverage and testing strategies
- `system-maintenance`: Cleanup, deduplication, and maintenance
- `general`: Default category for uncategorized content

### Fallback Analysis

When LLM is unavailable, the system uses rule-based analysis:

```typescript
// Basic semantic category detection
if (content.includes('health') || content.includes('score')) 
  semanticCategory = 'repository-health';
if (content.includes('automation') || content.includes('workflow')) 
  semanticCategory = 'automation';
// ... more rules
```

## 🔗 Relationship Detection

### Similarity Calculation

Uses word overlap similarity for relationship detection:

```typescript
const similarity = intersection.size / union.size;
```

### Relationship Types

1. **Related To**: Fossils with similar content (similarity > 60%)
2. **Depends On**: Fossils referenced or mentioned in content
3. **Supersedes**: Newer fossils that replace older similar content
4. **Part Of**: Fossils that belong to larger initiatives

## ⏰ Temporal Management

### Lifecycle Rules

```typescript
// Determine lifecycle based on age and type
if (daysSinceCreation > 365) lifecycle = 'archived';
if (entry.type === 'result' && daysSinceCreation > 30) lifecycle = 'archived';
```

### Expiration Rules

```typescript
// Set expiration for certain types
if (entry.type === 'observation' && daysSinceCreation > 90) {
  expiresAt = new Date(createdAt.getTime() + 90 * 24 * 60 * 60 * 1000);
}
```

## 📊 Benefits for LLMs

### 1. **Enhanced Context Retrieval**
- Semantic similarity enables better content discovery
- Priority and impact tags help prioritize relevant information
- Stakeholder tags ensure context is relevant to the user

### 2. **Improved Understanding**
- Sentiment analysis provides emotional context
- Semantic categories enable topic-based reasoning
- Confidence scores indicate reliability of information

### 3. **Better Decision Making**
- Relationship mapping shows dependencies and connections
- Temporal tags indicate freshness and relevance
- Lifecycle status helps determine actionability

### 4. **Reduced Hallucination**
- Rich metadata provides more context for LLM reasoning
- Confidence scores help LLMs assess information reliability
- Relationship mapping shows information provenance

## 🔧 Configuration

### Environment Variables

```bash
# Required for LLM-powered tagging
OPENAI_API_KEY=your_openai_api_key

# Optional: Custom model
OPENAI_MODEL=gpt-4
```

### Model Selection

```typescript
// Default model
const semanticTagger = new SemanticTaggerService();

// Custom model
const semanticTagger = new SemanticTaggerService('gpt-4-turbo', apiKey);
```

## 📈 Performance Considerations

### LLM Usage Optimization

1. **Batch Processing**: Enhance multiple fossils in sequence
2. **Caching**: Cache semantic analysis results
3. **Fallback**: Graceful degradation when LLM is unavailable
4. **Rate Limiting**: Respect API rate limits

### Storage Impact

- **Semantic Tags**: ~500 bytes per fossil
- **Relationships**: ~200 bytes per fossil
- **Temporal Data**: ~100 bytes per fossil
- **Total Overhead**: ~800 bytes per fossil

## 🧪 Testing

### Unit Tests

```bash
# Run semantic tagging tests
bun test tests/unit/services/semantic-tagger.test.ts
```

### Integration Tests

```bash
# Test full enhancement workflow
bun test tests/integration/context-fossil.integration.test.ts
```

## 🔮 Future Enhancements

### Planned Features

1. **Multi-Modal Analysis**: Support for images and diagrams
2. **Custom Taxonomies**: User-defined semantic categories
3. **Learning System**: Improve tagging based on user feedback
4. **Graph Visualization**: Visual relationship mapping
5. **Advanced NLP**: Named entity recognition and topic modeling

### API Extensions

1. **Bulk Operations**: Enhance multiple fossils efficiently
2. **Custom Prompts**: User-defined analysis prompts
3. **Tag Validation**: Verify semantic tag accuracy
4. **Relationship Visualization**: Export relationship graphs

## 📚 Examples

### Example Enhanced Fossil

```json
{
  "id": "fossil_123",
  "type": "observation",
  "title": "Repository Health Analysis",
  "content": "Health score: 85/100. Issues: 2. Recommendations: Add tests.",
  "semanticTags": {
    "semanticCategory": "repository-health",
    "confidence": 0.95,
    "concepts": ["health-score", "issues", "recommendations", "testing"],
    "sentiment": "neutral",
    "priority": "medium",
    "impact": "medium",
    "stakeholders": ["developers", "admins"]
  },
  "relationships": {
    "relatedTo": ["fossil_456", "fossil_789"],
    "dependsOn": ["fossil_101"]
  },
  "temporal": {
    "lifecycle": "active",
    "lastAccessed": "2025-07-01T00:00:00.000Z",
    "accessCount": 5
  }
}
```

### Query Examples

```bash
# Find high-priority automation issues
bun run src/cli/context-fossil.ts query --tags "automation,high-priority"

# Find recent repository health issues
bun run src/cli/context-fossil.ts query --tags "repository-health,active"

# Find fossils with positive sentiment
bun run src/cli/context-fossil.ts query --tags "positive-sentiment"
```

## 🎉 Conclusion

The Intelligent Tagging System transforms the context fossil storage from a simple key-value store into a sophisticated knowledge graph with rich semantic understanding. This enhancement significantly improves LLM interactions by providing:

- **Better Context Retrieval**: Semantic similarity and relationship mapping
- **Improved Understanding**: Rich metadata and confidence scoring
- **Enhanced Decision Making**: Priority, impact, and temporal context
- **Reduced Hallucination**: Comprehensive context and provenance tracking

The system is designed to be robust, scalable, and user-friendly, with graceful fallbacks and comprehensive documentation for easy integration and maintenance. 